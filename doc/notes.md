# Notes

This document contains various information used to debug and test `peetch` features.

# Tests

* `openssl s_client`
```
rm secrets.txt ; (sleep 1 ;echo -e "GET /?secret=$RANDOM HTTP/1.1\r\nHost: www.perdu.com\r\n\r\n") |openssl s_client -connect www.perdu.com:443 -keylogfile secrets.txt -no_tls1_3 -4; cat secrets.txt
```

* test the connectin to the proxy
```
curl --connect-to www.perdu.com:443:127.0.0.1:2807 https://www.perdu.com
```

* libcurl binaries
```
# TLS1.2 & HTTP/1.1
curl https://echo.free.beeceptor.com/?secret_number=$RANDOM --tls-max 1.2 --http1.1 --tlsv1.2 --libcurl secret_binary.c
cc -o secret_binary secret_binary.c -lssl -lcurl && ./secret_binary

# TLS1.2 & HTTP/2.0
curl https://echo.free.beeceptor.com/?secret_number=$RANDOM --tls-max 1.2 --http2 --tlsv1.2 --libcurl secret_binary2.c
cc -o secret_binary2 secret_binary2.c -lssl -lcurl && ./secret_binary2
```

# OpenSSL Offsets

The following radare2 commands could be used to validate the OpenSSL offsets dynamically generated by `peetch`:

```
cat curl.rr2
#!/usr/bin/rarun2
program=/usr/bin/curl
arg0=5
arg1=--tls-max
arg2=1.2
arg3=--tlsv1.2
arg4=--http1.1
arg5=https://www.perdu.com

radare2 -e dbg.profile=curl.rr2 -A -d /usr/bin/curl
[...]> dcu sym.imp.curl_globa_init
[...]> dmi libssl SSL_read
[...]> dmi libssl SSL_write
[...]> db 0xffffa479eeb4 # address of SSL_read
[...]> db 0xffff9086f504 # address of SSL_write
[...]> dc

[...]> px 48 @ `pv @ x0 + 0x918` + 0x50 # offset off ssl_session and master_secret
- offset - 6061 6263 6465 6667 6869 6A6B 6C6D 6E6F 0123456789ABCDEF
0xaaab0a47aa60 ce6a 7675 5e95 dfd4 e5ed 10c1 c0b7 9bd9 .jvu^...........
0xaaab0a47aa70 808f 416a 13ef cb29 6c8e 323a 40cb e5ea ..Aj...)l.2:@...
0xaaab0a47aa80 ccdb 09d2 7f46 7fb9 7115 6082 f4dc 2725 .....F..q.`...'%
```
```